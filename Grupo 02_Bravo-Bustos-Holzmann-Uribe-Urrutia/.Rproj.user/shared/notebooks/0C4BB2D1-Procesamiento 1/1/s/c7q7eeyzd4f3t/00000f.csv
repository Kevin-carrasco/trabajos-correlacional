"0","#| label: fig-heatmap-ism"
"0","#| fig-cap: 'Mapa de calor: ISM Promedio por edad y sexo'"
"0","#| code-fold: true"
"0","#| code-summary: ""Ver código"""
"0","#| warning: false "
"0","#| message: false"
"0","#| fig-align: center"
"0","#| out-width: 80%"
"0",""
"0","# Heatmap para ISM respecto edad y sexo "
"0","## Calcular medias por grupo "
"0","heatmap_data <- datos %>%"
"0","  group_by(edad_tramo_num, R_sexo) %>%"
"0","  summarise("
"0","    media_ism = mean(ISM, na.rm = TRUE),"
"0","    n = n(),"
"0"," .groups = 'drop'"
"0","  ) %>%"
"0","  mutate("
"0","    grupo_edad = factor(edad_tramo_num, "
"0","                        labels = c(""18-29"", ""30-44"", ""45-59"", ""60-79"", ""80+"")),"
"0","    sexo = factor(R_sexo, labels = c(""Hombre"", ""Mujer""))"
"0","  )"
"0",""
"0","#Generar Heatmap "
"0","ggplot(heatmap_data, aes(x = grupo_edad, y = sexo, fill = media_ism)) +"
"0","  geom_tile(color = ""white"", linewidth = 1) +"
"0","  geom_text(aes(label = round(media_ism, 2)), color = ""black"", size = 4) +"
"0","  scale_fill_gradient2(low = ""red"", mid = ""white"", high = ""blue"", "
"0","                       midpoint = mean(heatmap_data$media_ism),"
"0","                       name = ""ISM (Media)"") +"
"0","  labs(title = ""Mapa de Calor: ISM Promedio por Edad y Sexo"","
"0","       x = ""Grupo de Edad"", "
"0","       y = ""Sexo"","
"0","       caption = ""Fuente: Elaboración propia en base a Encuesta ELSOC ola 2022."") + "
"0","  theme_minimal()"
