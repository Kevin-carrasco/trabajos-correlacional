---
title: "Resultados"
---

# Análisis

# Análisis descriptivo

```{r}
#| echo: false
#| warning: false
#| message: false

pacman::p_load(tidyverse, # Manipulacion datos
               sjPlot, # Graficos y tablas
               sjmisc, # Descriptivos
               corrplot, # Correlaciones
               psych, # Test estadísticos
               kableExtra, # Tablas
               rempsyc,
               broom,
               sjstats,
               gginference)

options(scipen = 999) # para desactivar notacion cientifica
rm(list = ls()) # para limpiar el entorno de trabajo
library(readxl)

simce <- read_excel("C:/Users/crist/Documents/TrabajodefEstadistica/resultadossimce6b2024.xlsx")
rbd <- read_excel("C:/Users/crist/Documents/TrabajodefEstadistica/simce6b2024_rbd.xlsx")


```

```{r}
#| echo: false
#| warning: false
#| message: false

simce2 <- simce %>%
  left_join(
    rbd %>%
      select(cod_com_rbd, cod_rural_rbd) %>% 
      distinct(), 
    by = c("cod_com" = "cod_com_rbd")
  )

#codificar ------

simce2 <- simce2 %>% 
  rename(
    comuna = nom_com,
    provincia = nom_deprov,
    prom_lenguaje = prom_lect6b_com,
    ruralidad = cod_rural_rbd
  )


```

## Tendencia central...

```{r}
#| echo: false
#| warning: false
#| message: false

summary(simce2$prom_lenguaje)

mean_simce <- mean(simce2$prom_lenguaje, na.rm = TRUE)
sd_simce <- sd(simce2$prom_lenguaje, na.rm = TRUE)

ic_simce <- t.test(simce2$prom_lenguaje)$conf.int


```

La tendencia...

## Grafico del rendimiento de la prueba

```{r}
#| echo: false
#| warning: false
#| message: false

hist(simce2$prom_lenguaje,
     xlab="Distribución del rendimiento simce en Lenguaje",
     main="Puntaje promedio",
     col="skyblue")

```

Puntaje promedio...

## División entre Rural y Urbano

```{r}
#| echo: false
#| warning: false
#| message: false


simce2$ruralidad <- factor(
  simce2$ruralidad,
  levels = c(1,2),
  labels = c("Urbana", "Rural")
)

tabla_rural <- table(simce2$ruralidad)

```

```{r}
#| echo: false
#| warning: false
#| message: false

barplot(tabla_rural,
        main="Distribución de comunas según ruralidad",
        col=c("orange","darkolivegreen3"),
        ylab="Frecuencia")
```

La muestra incluye comunas rurales y urbanas...

## Rendimiento Promedio según Ruralidad

```{r}
#| echo: false 
#| warning: false 
#| message: false



t_urbana <- t.test(
  simce2$prom_lenguaje[simce2$ruralidad == "Urbana"],
  alternative = "two.sided",
  conf.level = 0.95
)

t_rural <- t.test(
  simce2$prom_lenguaje[simce2$ruralidad == "Rural"],
  alternative = "two.sided",
  conf.level = 0.95
)

test_rural_urb <- t.test(
  prom_lenguaje ~ ruralidad,
  data = simce2,
  alternative = "two.sided",
  conf.level = 0.95
)

stats_table <- tidy(test_rural_urb, conf.int = TRUE)

```

```{r}
#| echo: false 
#| warning: false 
#| message: false

nice_table(stats_table, broom = "t.test")

```

La prueba t indica..

## Rendimiento promedio por provincia

```{r}
#| echo: false
#| warning: false
#| message: false

rend_prov <- simce2 %>%
  group_by(provincia) %>%
  summarise(
    media = mean(prom_lenguaje, na.rm = TRUE),
    sd = sd(prom_lenguaje, na.rm = TRUE),
    n = n()
  ) %>%
  arrange(desc(media))


```

```{r}
#| echo: false
#| warning: false
#| message: false

ggplot(rend_prov, aes(x = reorder(provincia, media), y = media)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Rendimiento promedio en Lenguaje por provincia",
    x = "Provincia",
    y = "Puntaje promedio"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 6)  # Tamaño del texto más pequeño
  )
```

Se observa....

```{r}
#| echo: false
#| warning: false
#| message: false

prom_nacional <- mean(simce2$prom_lenguaje, na.rm = TRUE)

# Diferencia respecto al promedio nacional
simce2$dif_prom <- simce2$prom_lenguaje - prom_nacional

# Tabla de contingencia: bajo el promedio X ruralidad
tabla_dif <- table(
  BajoPromedio = simce2$dif_prom < 0,
  Ruralidad = simce2$ruralidad
)

# Convertir a data frame
tabla_dif2 <- as.data.frame(tabla_dif)

# Etiquetas bonitas para el gráfico
tabla_dif2$BajoPromedio <- factor(
  tabla_dif2$BajoPromedio,
  levels = c(FALSE, TRUE),
  labels = c("Sobre el promedio", "Bajo el promedio")
)


```

```{r}
#| echo: false
#| warning: false
#| message: false

ggplot(tabla_dif2, aes(x = Ruralidad, y = Freq, fill = BajoPromedio)) +
  geom_col(position = "dodge") +
  labs(
    title = "Comunas sobre y bajo el promedio nacional según ruralidad",
    x = "Ruralidad",
    y = "Número de comunas",
    fill = "Desempeño"
  ) +
  scale_fill_manual(values = c("Sobre el promedio" = "steelblue",
                               "Bajo el promedio" = "tomato"))
```

El cruce entre ruralidad...
