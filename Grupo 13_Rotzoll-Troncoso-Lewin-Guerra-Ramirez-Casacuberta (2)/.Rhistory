filter(ola == 7) %>%
select(
idencuesta,
m0_sexo,
m13,
depresion_1 = s11_01,
depresion_2 = s11_02,
depresion_3 = s11_03,
depresion_4 = s11_04,
depresion_5 = s11_05,
depresion_6 = s11_06,
depresion_7 = s11_07,
depresion_8 = s11_09
)
# -------------------------------------------------------------------------
# 4. Recodificación de variables ------------------------------------------
# -------------------------------------------------------------------------
Datos_ELSOC <- Datos_ELSOC %>%
# 4.1 Recodificar ítems de depresión (1–5 → 0–4)
mutate(across(
starts_with("depresion"),
~ case_when(
.x %in% 1:5 ~ .x - 1,
.x %in% c(-999, -888, -666) ~ NA_real_,
TRUE ~ NA_real_
)
)) %>%
# 4.2 Recodificar género
mutate(
genero = case_when(
m0_sexo == 1 ~ "Hombre",
m0_sexo == 2 ~ "Mujer",
TRUE ~ NA_character_
),
genero = factor(genero, levels = c("Hombre", "Mujer"))
) %>%
# 4.3 Limpiar ingreso m13 (solo reemplazar códigos de error)
mutate(
m13 = ifelse(m13 %in% c(-999, -888, -666), NA, m13)
)
# -------------------------------------------------------------------------
# 5. Análisis psicométrico de depresión -----------------------------------
# -------------------------------------------------------------------------
variables_depresion <- Datos_ELSOC %>%
select(starts_with("depresion"))
# Promedios por ítem
promedios_dep <- variables_depresion %>%
summarise(across(everything(), ~ mean(.x, na.rm = TRUE)))
promedios_dep
# Correlaciones
matriz_cor <- cor(variables_depresion, use = "pairwise.complete.obs")
matriz_cor
sjPlot::tab_corr(
variables_depresion,
na.deletion = "pairwise",
triangle = "lower"
)
# Alpha de Cronbach
alpha_dep <- psych::alpha(variables_depresion)
alpha_dep
# -------------------------------------------------------------------------
# 6. Crear escala de depresión (rangos fijos) ------------------------------
# -------------------------------------------------------------------------
Datos_ELSOC <- Datos_ELSOC %>%
mutate(
# 1. Escala continua: promedio de los ítems
depresion = rowMeans(
select(., starts_with("depresion")),
na.rm = TRUE
),
# 2. Escala ordinal (4 niveles)
depresion_ordinal = case_when(
depresion >= 0 & depresion < 1 ~ "Bajo",
depresion >= 1 & depresion < 2 ~ "Medio bajo",
depresion >= 2 & depresion < 3 ~ "Medio alto",
depresion >= 3 & depresion <= 4 ~ "Alto",
TRUE ~ NA_character_
),
# 3. Convertir a factor ordenado SIN generar niveles extra
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Bajo", "Medio bajo", "Medio alto", "Alto"),
ordered = TRUE
),
# 4. Eliminar niveles fantasma como "Medio"
depresion_ordinal = droplevels(depresion_ordinal)
)
# -------------------------------------------------------------------------
# 7. Quintiles de ingreso                  --------------------------------
# -------------------------------------------------------------------------
Datos_ELSOC <- Datos_ELSOC %>%
mutate(
# Reemplazar códigos de no respuesta por NA
m13 = ifelse(m13 %in% c(-666, -888, -999), NA_real_, m13),
# Crear quintiles
m13_quintil = ntile(m13, 5),
m13_quintil = factor(
m13_quintil,
levels = 1:5,
labels = c("Q1 (más bajo)", "Q2", "Q3", "Q4", "Q5 (más alto)"),
ordered = TRUE
)
)
# -------------------------------------------------------------------------
# 8. Mostrar cortes reales de quintiles -----------------------------------
# -------------------------------------------------------------------------
quintiles_m13 <- quantile(Datos_ELSOC$m13, probs = seq(0, 1, 0.2), na.rm = TRUE)
quintiles_m13
#| label: fig-nivsoc
#| fig-cap: "Distribución de Nivel de Depresión por Quintil"
#| echo: false
#| message: false
#| warning: false
#| eval: true
datos_quintil <- Datos_ELSOC %>%
# 1. Filtrar NAs
filter(!is.na(m13_quintil), !is.na(depresion_ordinal)) %>%
# 2. Limpiar y ordenar etiquetas
mutate(
quintil_simple = case_when(
m13_quintil == "Q1 (más bajo)" ~ "Q1",
m13_quintil == "Q5 (más alto)" ~ "Q5",
TRUE ~ as.character(m13_quintil)
),
quintil_simple = factor(
quintil_simple,
levels = c("Q1", "Q2", "Q3", "Q4", "Q5")
),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
# 3. Filtro de seguridad final
filter(!is.na(quintil_simple), !is.na(depresion_ordinal)) %>%
# 4. Conteo
count(quintil_simple, depresion_ordinal, .drop = TRUE) %>%
group_by(quintil_simple) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Gráfico
ggplot(datos_quintil, aes(x = quintil_simple, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.75) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Quintil de Ingresos",
x = "Quintil de Ingresos",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por Quintil"
#| echo: false
#| message: false
#| warning: false
#| eval: true
datos_quintil <- Datos_ELSOC %>%
filter(!is.na(m13_quintil), !is.na(depresion_ordinal)) %>%
mutate(
quintil_simple = case_when(
m13_quintil == "Q1 (más bajo)" ~ "Q1",
m13_quintil == "Q5 (más alto)" ~ "Q5",
TRUE ~ as.character(m13_quintil)
),
quintil_simple = factor(
quintil_simple,
levels = c("Q1", "Q2", "Q3", "Q4", "Q5")
),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
filter(!is.na(quintil_simple), !is.na(depresion_ordinal)) %>%
count(quintil_simple, depresion_ordinal, .drop = TRUE) %>%
group_by(quintil_simple) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Gráfico
ggplot(datos_quintil, aes(x = quintil_simple, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.75) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Quintil de Ingresos",
x = "Quintil de Ingresos",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por Quintil"
#| echo: false
#| message: false
#| warning: false
#| eval: true
datos_quintil <- Datos_ELSOC %>%
filter(!is.na(m13_quintil), !is.na(depresion_ordinal)) %>%
mutate(
quintil_simple = case_when(
m13_quintil == "Q1 (más bajo)" ~ "Q1",
m13_quintil == "Q5 (más alto)" ~ "Q5",
TRUE ~ as.character(m13_quintil)
),
quintil_simple = factor(
quintil_simple,
levels = c("Q1", "Q2", "Q3", "Q4", "Q5")
),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
filter(!is.na(quintil_simple), !is.na(depresion_ordinal)) %>%
count(quintil_simple, depresion_ordinal, .drop = TRUE) %>%
group_by(quintil_simple) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Gráfico
ggplot(datos_quintil, aes(x = quintil_simple, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.75) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Quintil de Ingresos",
x = "Quintil de Ingresos",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por Quintil"
#| echo: false
#| message: false
#| warning: false
#| eval: true
datos_quintil <- Datos_ELSOC %>%
filter(!is.na(m13_quintil), !is.na(depresion_ordinal)) %>%
mutate(
quintil_simple = case_when(
m13_quintil == "Q1 (más bajo)" ~ "Q1",
m13_quintil == "Q5 (más alto)" ~ "Q5",
TRUE ~ as.character(m13_quintil)
),
quintil_simple = factor(
quintil_simple,
levels = c("Q1", "Q2", "Q3", "Q4", "Q5")
),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
filter(!is.na(quintil_simple), !is.na(depresion_ordinal)) %>%
count(quintil_simple, depresion_ordinal, .drop = TRUE) %>%
group_by(quintil_simple) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Gráfico
ggplot(datos_quintil, aes(x = quintil_simple, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.75) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Quintil de Ingresos",
x = "Quintil de Ingresos",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por Quintil"
#| echo: false
#| message: false
#| warning: false
#| eval: true
datos_quintil <- Datos_ELSOC %>%
filter(!is.na(m13_quintil), !is.na(depresion_ordinal)) %>%
mutate(
quintil_simple = case_when(
m13_quintil == "Q1 (más bajo)" ~ "Q1",
m13_quintil == "Q5 (más alto)" ~ "Q5",
TRUE ~ as.character(m13_quintil)
),
quintil_simple = factor(
quintil_simple,
levels = c("Q1", "Q2", "Q3", "Q4", "Q5")
),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
filter(!is.na(quintil_simple), !is.na(depresion_ordinal)) %>%
count(quintil_simple, depresion_ordinal, .drop = TRUE) %>%
group_by(quintil_simple) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
# Gráfico
ggplot(datos_quintil, aes(x = quintil_simple, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.75) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Quintil de Ingresos",
x = "Quintil de Ingresos",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por género"
#|
datos_genero <- Datos_ELSOC %>%
filter(!is.na(genero), !is.na(depresion_ordinal)) %>%
mutate(
genero = droplevels(genero),
depresion_ordinal = droplevels(depresion_ordinal),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
count(genero, depresion_ordinal) %>%
group_by(genero) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
ggplot(datos_genero, aes(x = genero, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.7) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Género",
x = "Género",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por género"
#| echo: false
#| message: false
#| warning: false
datos_genero <- Datos_ELSOC %>%
filter(!is.na(genero), !is.na(depresion_ordinal)) %>%
mutate(
genero = droplevels(genero),
depresion_ordinal = droplevels(depresion_ordinal),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
count(genero, depresion_ordinal) %>%
group_by(genero) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
ggplot(datos_genero, aes(x = genero, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.7) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Género",
x = "Género",
y = "Proporción"
) +
theme_minimal()
#| label: fig-nivygen
#| fig-cap: "Distribución de Nivel de Depresión por género"
#| echo: false
#| message: false
#| warning: false
datos_genero <- Datos_ELSOC %>%
filter(!is.na(genero), !is.na(depresion_ordinal)) %>%
mutate(
genero = droplevels(genero),
depresion_ordinal = droplevels(depresion_ordinal),
depresion_ordinal = factor(
depresion_ordinal,
levels = c("Alto", "Medio alto", "Medio bajo", "Bajo"),
ordered = TRUE
)
) %>%
count(genero, depresion_ordinal) %>%
group_by(genero) %>%
mutate(prop = n / sum(n)) %>%
ungroup()
ggplot(datos_genero, aes(x = genero, y = prop, fill = depresion_ordinal)) +
geom_col(position = "stack", width = 0.7) +
geom_text(
aes(label = scales::percent(prop, accuracy = 0.1)),
position = position_stack(vjust = 0.5),
color = "black",
size = 3.3
) +
scale_fill_manual(
values = c(
"Alto"       = "#e04f4f",
"Medio alto" = "#f4a259",
"Medio bajo" = "#d4e87f",
"Bajo"       = "#b6e8b3"
),
name = "Nivel de Depresión"
) +
scale_y_continuous(labels = scales::percent) +
labs(
title = "Niveles de Depresión según Género",
x = "Género",
y = "Proporción"
) +
theme_minimal()
